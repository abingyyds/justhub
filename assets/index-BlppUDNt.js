const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/index-GoQX1wH5.js","assets/index-CkwDI39N.js","assets/index-BOEMHBww.css","assets/parseSignature-CBntueyT.js","assets/localBatchGatewayRequest-Bz6RBYZC.js","assets/hashTypedData-BzH49Cpe.js","assets/index-CEfQ5moC.js","assets/index-My90LZL7.js","assets/index-BOBjlM2t.js"])))=>i.map(i=>d[i]);
import{di as _,bw as l,aZ as C,dj as b,c7 as m,b5 as g,dk as y,dl as v,cu as I}from"./index-CkwDI39N.js";import{dm as L}from"./index-CkwDI39N.js";function D(h={}){let p,s,c,o;return _(n=>({id:"baseAccount",name:"Base Account",rdns:"app.base.account",type:"baseAccount",async connect({chainId:e,withCapabilities:t,...i}={}){try{const r=await this.getProvider(),a=e??n.chains[0]?.id;if(!a)throw new b;let{accounts:u,currentChainId:f}=await(async()=>{if(i.isReconnecting)return{accounts:(await r.request({method:"eth_accounts",params:[]})).map(d=>({address:l(d)})),currentChainId:await this.getChainId()};const w=await r.request({method:"wallet_connect",params:[{capabilities:"capabilities"in i&&i.capabilities?i.capabilities:{},chainIds:[m(a),...n.chains.filter(d=>d.id!==a).map(d=>m(d.id))]}]});return{accounts:w.accounts.map(d=>({address:l(d.address),capabilities:d.capabilities??{}})),currentChainId:Number(w.chainIds[0])}})();return s||(s=this.onAccountsChanged.bind(this),r.on("accountsChanged",s)),c||(c=this.onChainChanged.bind(this),r.on("chainChanged",c)),o||(o=this.onDisconnect.bind(this),r.on("disconnect",o)),e&&f!==e&&(f=(await this.switchChain({chainId:e}).catch(d=>{if(d.code===g.code)throw d;return{id:f}}))?.id??f),{accounts:t?u:u.map(w=>w.address),chainId:f}}catch(r){throw/(user closed modal|accounts received is empty|user denied account|request rejected)/i.test(r.message)?new g(r):r}},async disconnect(){const e=await this.getProvider();s&&(e.removeListener("accountsChanged",s),s=void 0),c&&(e.removeListener("chainChanged",c),c=void 0),o&&(e.removeListener("disconnect",o),o=void 0),e.disconnect()},async getAccounts(){return(await(await this.getProvider()).request({method:"eth_accounts"})).map(t=>l(t))},async getChainId(){const t=await(await this.getProvider()).request({method:"eth_chainId"});return Number(t)},async getProvider(){if(!p){const e=typeof h.preference=="string"?{options:h.preference}:{...h.preference,options:h.preference?.options??"all"},{createBaseAccountSDK:t}=await y(async()=>{const{createBaseAccountSDK:r}=await import("./index-GoQX1wH5.js");return{createBaseAccountSDK:r}},__vite__mapDeps([0,1,2,3,4,5]));p=t({...h,appChainIds:n.chains.map(r=>r.id),preference:e}).getProvider()}return p},async isAuthorized(){try{return!!(await this.getAccounts()).length}catch{return!1}},async switchChain({addEthereumChainParameter:e,chainId:t}){const i=n.chains.find(a=>a.id===t);if(!i)throw new C(new b);const r=await this.getProvider();try{return await r.request({method:"wallet_switchEthereumChain",params:[{chainId:m(i.id)}]}),i}catch(a){if(a.code===4902)try{let u;e?.blockExplorerUrls?u=e.blockExplorerUrls:u=i.blockExplorers?.default.url?[i.blockExplorers?.default.url]:[];let f;e?.rpcUrls?.length?f=e.rpcUrls:f=[i.rpcUrls.default?.http[0]??""];const w={blockExplorerUrls:u,chainId:m(t),chainName:e?.chainName??i.name,iconUrls:e?.iconUrls,nativeCurrency:e?.nativeCurrency??i.nativeCurrency,rpcUrls:f};return await r.request({method:"wallet_addEthereumChain",params:[w]}),i}catch(u){throw new g(u)}throw new C(a)}},onAccountsChanged(e){e.length===0?this.onDisconnect():n.emitter.emit("change",{accounts:e.map(t=>l(t))})},onChainChanged(e){const t=Number(e);n.emitter.emit("change",{chainId:t})},async onDisconnect(e){n.emitter.emit("disconnect");const t=await this.getProvider();s&&(t.removeListener("accountsChanged",s),s=void 0),c&&(t.removeListener("chainChanged",c),c=void 0),o&&(t.removeListener("disconnect",o),o=void 0)}}))}A.type="safe";function A(h={}){const{shimDisconnect:p=!1}=h;let s,c;return _(o=>({id:"safe",name:"Safe",type:A.type,async connect({withCapabilities:n}={}){const e=await this.getProvider();if(!e)throw new v;const t=await this.getAccounts(),i=await this.getChainId();return c||(c=this.onDisconnect.bind(this),e.on("disconnect",c)),p&&await o.storage?.removeItem("safe.disconnected"),{accounts:n?t.map(r=>({address:r,capabilities:{}})):t,chainId:i}},async disconnect(){const n=await this.getProvider();if(!n)throw new v;c&&(n.removeListener("disconnect",c),c=void 0),p&&await o.storage?.setItem("safe.disconnected",!0)},async getAccounts(){const n=await this.getProvider();if(!n)throw new v;return(await n.request({method:"eth_accounts"})).map(l)},async getProvider(){if(typeof window<"u"&&window?.parent!==window){if(!s){const{default:e}=await y(async()=>{const{default:a}=await import("./index-CEfQ5moC.js");return{default:a}},__vite__mapDeps([6,7,1,2,5])),t=new e(h),i=await I(()=>t.safe.getInfo(),{timeout:h.unstable_getInfoTimeout??10});if(!i)throw new Error("Could not load Safe information");const r=await(async()=>{const a=await y(()=>import("./index-BOBjlM2t.js").then(u=>u.i),__vite__mapDeps([8,1,2,7]));return typeof a.SafeAppProvider!="function"&&typeof a.default.SafeAppProvider=="function"?a.default.SafeAppProvider:a.SafeAppProvider})();s=new r(i,t)}return s}},async getChainId(){const n=await this.getProvider();if(!n)throw new v;return Number(n.chainId)},async isAuthorized(){try{return p&&await o.storage?.getItem("safe.disconnected")?!1:!!(await this.getAccounts()).length}catch{return!1}},onAccountsChanged(){},onChainChanged(){},onDisconnect(){o.emitter.emit("disconnect")}}))}export{D as baseAccount,L as injected,A as safe};
